<!-- FuncionesTrigonometricasInversas-->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Operaci√≥n (A ‚à© B) ‚à™ C</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/venn.js@0.2.20/venn.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #fff;
    }
    h2 {
      margin-top: 20px;
    }
    .contenedor {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 30px;
      margin-top: 20px;
    }
    .diagrama {
      border: 2px solid red;
      padding: 10px;
    }
    .igual {
      font-size: 40px;
      font-weight: bold;
    }
    .venn-area path {
      stroke: none;
    }
    #venn1 .venn-area path {
      fill-opacity: 0.2;
    }
    #venn1 text {
      font-weight: bold;
    }
    #venn2 .venn-area path {
      fill-opacity: 0.5;
    }
    #venn2 text {
      display: none;
    }
    #tiempo, #operaciones {
      color: green;
      font-weight: bold;
    }
    .btn {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      cursor: pointer;
      min-width: 220px;
    }
    #btnCerrar {
      background-color: red;
      color: white;
    }
    #btnCerrar:hover {
      background-color: darkred;
    }
    #btnEjercicio {
      background-color: blue;
      color: white;
    }
    #btnEjercicio:hover {
      background-color: darkblue;
    }
    #btnSolucion {
      background-color: orange;
      color: white;
    }
    #btnSolucion:hover {
      background-color: darkorange;
    }
    #resultado, #instruccion {
      margin-top: 15px;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h2>Operaci√≥n entre conjuntos: (A ‚à© B) ‚à™ C</h2>
  <div id="tiempo">Tiempo usando el simulador: 0 min 0 seg</div>
  <div id="operaciones">N√∫mero de operaciones realizadas: 0</div>

  <div class="contenedor">
    <div class="diagrama"><div id="venn1"></div></div>
    <div class="igual">=</div>
    <div class="diagrama"><div id="venn2"></div></div>
  </div>

  <div id="ejercicioContainer">
    <button id="btnEjercicio" class="btn" onclick="generarEjercicio()">Realizar un nuevo ejercicio</button>
    <div id="instruccion"></div>
    <button id="btnSolucion" class="btn" onclick="mostrarSolucion()" style="display:none;">Ver la soluci√≥n</button>
    <div id="resultado"></div>
  </div>

  <button id="btnCerrar" class="btn" onclick="cerrarSimulador()">Cerrar simulador</button>

  <script>
    let operaciones = 0;
    let segundos = 0;
    let conjuntoA = [];
    let conjuntoB = [];
    let conjuntoC = [];

    function actualizarTiempo() {
      segundos++;
      const minutos = Math.floor(segundos / 60);
      const restoSegundos = segundos % 60;
      document.getElementById('tiempo').innerText = `Tiempo usando el simulador: ${minutos} min ${restoSegundos} seg`;
    }

    const intervalo = setInterval(actualizarTiempo, 1000);

    async function cerrarSimulador() {
      clearInterval(intervalo);
      await sendTrackOnce();
      alert("Simulador cerrado.");
      window.close();
    }

    const sets = [
      { sets: ['A'], size: 10, label: 'A' },
      { sets: ['B'], size: 10, label: 'B' },
      { sets: ['C'], size: 10, label: 'C' },
      { sets: ['A','B'], size: 5 },
      { sets: ['A','C'], size: 5 },
      { sets: ['B','C'], size: 5 },
      { sets: ['A','B','C'], size: 2 }
    ];

    const chart1 = venn.VennDiagram();
    const div1 = d3.select("#venn1");
    div1.datum(sets).call(chart1);
    div1.selectAll("text").style("fill", d => {
      if (d.label === 'A') return "blue";
      if (d.label === 'B') return "orange";
      if (d.label === 'C') return "green";
      return "black";
    });

    const chart2 = venn.VennDiagram();
    const div2 = d3.select("#venn2");
    div2.datum(sets).call(chart2);
    div2.selectAll(".venn-area path")
      .style("fill", d => {
        const s = d.sets.sort().join(',');
        return (s === 'A,B' || s === 'A,B,C' || s === 'C') ? "green" : "lightgray";
      })
      .style("fill-opacity", d => {
        const s = d.sets.sort().join(',');
        return (s === 'A,B' || s === 'A,B,C' || s === 'C') ? 0.5 : 0.1;
      });

    function generarConjunto(cantidad) {
      const numeros = new Set();
      while (numeros.size < cantidad) {
        numeros.add(Math.floor(Math.random() * 10));
      }
      return Array.from(numeros);
    }

    function generarEjercicio() {
      conjuntoA = generarConjunto(5);
      conjuntoB = generarConjunto(4);
      conjuntoC = generarConjunto(3);

      const instruccion = `Resuelva para A = {${conjuntoA.join(', ')}}, B = {${conjuntoB.join(', ')}}, C = {${conjuntoC.join(', ')}} la operaci√≥n: (A ‚à© B) ‚à™ C`;
      document.getElementById('instruccion').innerText = instruccion;
      document.getElementById('btnSolucion').style.display = 'inline-block';
      document.getElementById('resultado').innerText = '';

      operaciones++;
      document.getElementById("operaciones").innerText = `N√∫mero de operaciones realizadas: ${operaciones}`;
    }

    function mostrarSolucion() {
      const interseccionAB = conjuntoA.filter(n => conjuntoB.includes(n));
      const resultado = [...new Set([...interseccionAB, ...conjuntoC])];
      document.getElementById('resultado').innerText = `(A ‚à© B) ‚à™ C = {${resultado.join(', ')}}`;
    }
  </script>
  <script>
    // üîπ Tracking para este simulador
    const SIM_KEY = "funciones_trigonometricas_inversas"; // identificador √∫nico
    let simStartAt = Date.now();
    let sentTrack = false;

    async function sendTrackOnce() {
      if (sentTrack) return;
      sentTrack = true;

      const durationMs = Math.max(0, Date.now() - simStartAt);
      try {
        await fetch("http://localhost:3001/api/simuladores/track", {
          method: "POST",
          credentials: "include",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ simulator: SIM_KEY, durationMs, operaciones })
        });
        console.log("‚úÖ Uso registrado:", SIM_KEY, durationMs, "ms", "ops:", operaciones);
      } catch (err) {
        console.error("‚ùå Error registrando uso:", err);
      }
    }

    // Enviar cuando el usuario cierre la pesta√±a
    window.addEventListener("beforeunload", sendTrackOnce);
  </script>
</body>
</html>
